{% extends "base.html" %}

{% block title %}Tag - Stock Plus{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h2>Tags</h2>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#tagModal" data-mode="create">
            ‚ûï Adicionar Tag
        </button>
    </div>

    <div class="card-body">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nome</th>
                    <th>Cor</th>
                    <th>A√ß√£o</th>
                </tr>
            </thead>
            
            <tbody>
                {% for tag in tags %}
                <tr>
                    <td>{{ tag.id }}</td>
                    <td>{{ tag.name }}</td>
                    <td>
                        <span class="badge" style="background-color: {{ tag.color }}; color: #fff;">
                            {{ tag.color }}
                        </span>
                    </td>
                    <td>
                        <button 
                            class="btn btn-sm btn-primary"
                            data-bs-toggle="modal"
                            data-bs-target="#tagModal"
                            data-mode="edit"
                            data-id="{{ tag.id }}"
                            data-name="{{ tag.name }}"
                            data-color="{{ tag.color }}"
                        >
                            ‚úèÔ∏è Editar
                        </button>
                        <button
                            class="btn btn-sm btn-danger"
                            data-bs-toggle="modal"
                            data-bs-target="#deleteModal"
                            data-id="{{ tag.id }}"
                            data-name="{{ tag.name }}"
                            data-color="{{ tag.color }}"
                        >
                            üóëÔ∏è Deletar
                        </button>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4">Nenhuma tag encontrada.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Modal de Adi√ß√£o/Edi√ß√£o -->
<div class="modal fade" id="tagModal" tabindex="-1" aria-labelledby="tagModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" id="tagForm">
                {% csrf_token %}
                {% include 'tag_form.html' %}
            </form>
        </div>
    </div>
</div>

<!-- Tag Modal de Exclus√£o -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Confirmar Exclus√£o</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Tem certeza de que deseja excluir esta tag?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <form method="post" id="deleteForm">
                    {% csrf_token %}
                    <input type="hidden" name="tag_id" id="deleteTagId">
                    <button type="submit" class="btn btn-danger">Excluir</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const tagModal = document.getElementById('tagModal');
    tagModal.addEventListener('show.bs.modal', event => {
        const button = event.relatedTarget;
        const mode = button.getAttribute('data-mode');
        const modalTitle = tagModal.querySelector('.modal-title');
        const form = tagModal.querySelector('form');
        const submitButton = document.getElementById('submit-button');

        if (mode === 'edit') {
            modalTitle.textContent = 'Editar Tag';
            form.action = `/tags/update/${button.dataset.id}/`;
            submitButton.textContent = 'Atualizar';

            document.getElementById('form-id').value = button.dataset.id;
            document.getElementById('form-name').value = button.dataset.name;
            document.getElementById('form-color').value = button.dataset.color;
        } else {
            modalTitle.textContent = 'Nova Tag';
            form.action = '/tags/create/';
            submitButton.textContent = 'Salvar';

            form.reset();
            document.getElementById('form-id').value = '';
        }
    });

    const deleteModal = document.getElementById('deleteModal');
    deleteModal.addEventListener('show.bs.modal', event => {
        const button = event.relatedTarget;
        const id = button.dataset.id;
        const form = deleteModal.querySelector('form');

        document.getElementById('deleteTagId').value = id;
        form.action = `/tags/delete/${id}/`;
    });
});
</script>
{% endblock %}