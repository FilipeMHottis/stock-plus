<div class="card shadow-lg border-0 rounded-3">
    <div class="card-header bg-purple text-white d-flex justify-content-between align-items-center">
        <h4 class="mb-0">Hist√≥rico de Vendas</h4>
    </div>

    <div class="card-body bg-dark text-light">

        <!-- üîç FILTROS -->
        <div class="row g-2 mb-3">
            <div class="col-md-4">
                <input id="filter-search" class="form-control bg-dark text-light" placeholder="Buscar por ID, cliente...">
            </div>
            <div class="col-md-3">
                <select id="filter-status" class="form-select bg-dark text-light">
                    <option value="">Status: Todos</option>
                    <option value="completed">Conclu√≠das</option>
                    <option value="scheduled">Agendadas</option>
                </select>
            </div>
            <div class="col-md-3">
                <select id="filter-date" class="form-select bg-dark text-light">
                    <option value="">Data: Todas</option>
                    <option value="today">Hoje</option>
                    <option value="yesterday">Ontem</option>
                    <option value="7">√öltimos 7 dias</option>
                    <option value="30">√öltimos 30 dias</option>
                </select>
            </div>
        </div>

        <!-- üîÑ TABELA DIN√ÇMICA -->
        <div class="table-responsive">
            <table class="table table-dark table-hover table-sm align-middle mb-0">
                <thead class="bg-purple text-white">
                    <tr>
                        <th>ID</th>
                        <th>Data</th>
                        <th>Cliente</th>
                        <th>Total (R$)</th>
                        <th>Status</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="sales-table-body">
                    <!-- JS CARREGA AQUI -->
                </tbody>
            </table>
        </div>

        <!-- PAGINA√á√ÉO -->
        <div class="d-flex justify-content-between align-items-center mt-3">
            <button class="btn btn-sm btn-outline-light" id="prev-page">Anterior</button>
            <span id="page-indicator">P√°gina 1</span>
            <button class="btn btn-sm btn-outline-light" id="next-page">Pr√≥xima</button>
        </div>

    </div>
</div>

{% include 'report/modals/sale_detail.html' %}
{% include 'report/modals/sale_delete.html' %}

<script>
document.addEventListener("DOMContentLoaded", () => {

    let currentPage = 1;

    async function loadSales() {
        const search = document.getElementById("filter-search").value;
        const status = document.getElementById("filter-status").value;
        const date = document.getElementById("filter-date").value;

        const url = `/report/sales/api/?page=${currentPage}&search=${search}&status=${status}&date=${date}`;

        const response = await fetch(url);
        const data = await response.json();
        console.log(data);

        if (!data.success) return;

        const tbody = document.getElementById("sales-table-body");
        tbody.innerHTML = "";

        data.sales.forEach(sale => {
            tbody.innerHTML += `
                <tr role="button">
                    <td>${sale.id}</td>
                    <td>${sale.date}</td>
                    <td>${sale.customer}</td>
                    <td>${sale.total.toFixed(2)}</td>
                    <td>${sale.status}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-warning text-white"
                                data-bs-toggle="modal"
                                data-bs-target="#viewSaleModal"
                                data-id="${sale.id}">
                            üëÅÔ∏è
                        </button>
                        <button class="btn btn-sm btn-outline-danger"
                                data-bs-toggle="modal"
                                data-bs-target="#deleteSaleModal"
                                data-sale-id="${sale.id}">
                            üóëÔ∏è
                        </button>
                    </td>
                </tr>`;
        });

        // atualizar pagina√ß√£o
        document.getElementById("page-indicator").textContent =
            `P√°gina ${data.page}`;

        document.getElementById("prev-page").disabled = !data.has_prev;
        document.getElementById("next-page").disabled = !data.has_next;
    }

    // Carregamento inicial
    loadSales();

    // Pagina√ß√£o
    document.getElementById("prev-page").onclick = () => {
        currentPage--;
        loadSales();
    };
    document.getElementById("next-page").onclick = () => {
        currentPage++;
        loadSales();
    };

    // Filtros
    document.getElementById("filter-search").oninput = () => {
        currentPage = 1;
        loadSales();
    };
    document.getElementById("filter-status").onchange = () => {
        currentPage = 1;
        loadSales();
    };
    document.getElementById("filter-date").onchange = () => {
        currentPage = 1;
        loadSales();
    };

});
</script>
