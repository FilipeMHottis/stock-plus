<div class="card bg-dark text-light shadow-sm sticky-top" style="top: 1rem;">
    <div class="card-header bg-purple d-flex justify-content-between align-items-center">
        <h5 class="mb-0">ðŸ›’ Carrinho</h5>
        <button type="button" id="clear-cart" class="btn btn-sm btn-outline-light">ðŸ§¹ Limpar</button>
    </div>

    <div class="card-body">
        <form method="POST" id="saleForm">
            {% csrf_token %}

            <div id="cart-items" class="mb-3 text-muted small">
                Nenhum produto no carrinho.
            </div>

            <hr class="border-secondary">

            <!-- Cliente -->
            <div class="mb-3">
                <label class="form-label fw-bold">Cliente</label>
                <input 
                    type="text" 
                    id="customer_search"
                    class="form-control bg-dark text-light border-secondary"
                    placeholder="Pesquisar cliente..."
                    autocomplete="off"
                    list="customer-list"
                >
                <datalist id="customer-list">
                    {% for c in customers %}
                        <option value="{{ c.name }} - {{ c.email }}" data-id="{{ c.id }}"></option>
                    {% endfor %}
                </datalist>
                <input type="hidden" name="customer" id="customer" value="1">
            </div>

            <!-- Tipo da venda -->
            <div class="mb-3">
                <label class="form-label fw-bold">Tipo da Venda</label>
                <select name="status" id="status" class="form-select bg-dark text-light border-secondary">
                    <option value="completed">Venda Agora (Concluir e baixar estoque)</option>
                    <option value="scheduled">Agendada (sem baixar estoque)</option>
                </select>
            </div>

            <!-- Data de Agendamento -->
            <div class="mb-3" id="scheduled-container" style="display:none;">
                <label class="form-label fw-bold">Data de Agendamento</label>
                <input id="scheduled_date" type="date" name="scheduled_date" class="form-control bg-dark text-light border-secondary">
            </div>

            <!-- Desconto -->
            <div class="mb-3">
                <label class="form-label fw-bold">Desconto (R$)</label>
                <input type="number" step="0.01" min="0" name="discount"
                        id="discount" class="form-control bg-dark text-light border-secondary" value="0">
            </div>

            <hr class="border-secondary">

            <!-- Totais -->
            <p class="mb-1">Itens: <strong id="summary-items">0</strong></p>
            <p class="mb-1">Desconto: R$ <strong id="summary-discount">0.00</strong></p>
            <h5 class="text-success">Total: R$ <span id="summary-total">0.00</span></h5>

            <button type="submit" class="btn btn-success w-100 mt-3 fw-bold">
                ðŸ’¾ Finalizar Venda
            </button>
        </form>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
    const input = document.getElementById("customer_search");
    const hidden = document.getElementById("customer");
    const options = document.querySelectorAll("#customer-list option");

    // Preencher campo visÃ­vel com o nome do cliente de id 1 ao carregar
    {% for c in customers %}
        {% if c.id == 1 %}
            input.value = "{{ c.name }} - {{ c.email }}";
        {% endif %}
    {% endfor %}

    input.addEventListener("change", function() {
        let found = false;
        options.forEach(opt => {
            if (opt.value === input.value) {
                hidden.value = opt.getAttribute("data-id");
                found = true;
            }
        });
        if (!found) {
            hidden.value = "";
        }
    });
});
</script>